<div class="reset-password-container">
  <div class="reset-password-card">
    <div class="form-header">
      <h2>Restablecer contraseña</h2>
      <p *ngIf="tokenValid && !submitted">Crea una nueva contraseña para tu cuenta.</p>
    </div>

    <!-- Loading state -->
    <div *ngIf="tokenChecking" class="loading-container">
      <div class="spinner"></div>
      <p>Verificando solicitud...</p>
    </div>

    <!-- Error state when token is invalid -->
    <div *ngIf="!tokenChecking && !tokenValid && !submitted" class="error-container">
      <i class="fas fa-exclamation-circle"></i>
      <p>{{ message }}</p>
      <button class="action-button" (click)="goToLogin()">Volver al inicio de sesión</button>
    </div>

    <!-- Form when token is valid -->
    <div *ngIf="!tokenChecking && tokenValid && !submitted" class="form-container">
      <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="contenedor">
        <!-- Password field -->
        <div class="form-group">
          <div class="input-wrapper" [class.error]="resetPasswordForm.get('password')?.invalid && 
                                                   (resetPasswordForm.get('password')?.touched || 
                                                    resetPasswordForm.get('password')?.dirty)">
            <i class="fas fa-lock"></i>
            <input [type]="showPassword ? 'text' : 'password'" 
                   formControlName="password" 
                   placeholder="Nueva contraseña" 
                   class="form-control"
                   autocomplete="new-password">
            <i class="fas" [class.fa-eye]="!showPassword" [class.fa-eye-slash]="showPassword" (click)="togglePassword()"></i>
          </div>
          <div class="error-message" *ngIf="resetPasswordForm.get('password')?.invalid && 
                                           (resetPasswordForm.get('password')?.touched || 
                                            resetPasswordForm.get('password')?.dirty)">
            <small>{{ getPasswordError() }}</small>
          </div>
        </div>

        <!-- Confirm Password field -->
        <div class="form-group">
          <div class="input-wrapper" [class.error]="(resetPasswordForm.get('confirmPassword')?.invalid && 
                                                    (resetPasswordForm.get('confirmPassword')?.touched || 
                                                     resetPasswordForm.get('confirmPassword')?.dirty)) || 
                                                     (resetPasswordForm.errors?.['notMatch'] && 
                                                     resetPasswordForm.get('confirmPassword')?.touched)">
            <i class="fas fa-lock"></i>
            <input [type]="showConfirmPassword ? 'text' : 'password'" 
                   formControlName="confirmPassword" 
                   placeholder="Confirmar contraseña" 
                   class="form-control"
                   autocomplete="new-password">
            <i class="fas" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword" (click)="toggleConfirmPassword()"></i>
          </div>
          <div class="error-message" *ngIf="(resetPasswordForm.get('confirmPassword')?.invalid && 
                                            (resetPasswordForm.get('confirmPassword')?.touched || 
                                             resetPasswordForm.get('confirmPassword')?.dirty)) || 
                                            (resetPasswordForm.errors?.['notMatch'] && 
                                             resetPasswordForm.get('confirmPassword')?.touched)">
            <small>{{ getConfirmPasswordError() }}</small>
          </div>
        </div>

        <!-- Submit button -->
        <button type="submit" class="submit-button" [disabled]="resetPasswordForm.invalid || isSubmitting">
          <span *ngIf="!isSubmitting">Cambiar contraseña</span>
          <span *ngIf="isSubmitting">Cambiando...</span>
        </button>
      </form>

      <div *ngIf="isError" class="message error">
        {{ message }}
      </div>
    </div>

    <!-- Success state after password reset -->
    <div *ngIf="submitted" class="success-message">
      <i class="fas fa-check-circle"></i>
      <p>{{ message }}</p>
      <p class="small-text">Tu contraseña ha sido actualizada correctamente.</p>
      <button class="action-button" (click)="goToLogin()">Ir al inicio de sesión</button>
    </div>
  </div>
</div>
