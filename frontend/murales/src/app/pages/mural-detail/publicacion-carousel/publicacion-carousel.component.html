<div class="carousel-modal" *ngIf="currentPublicacion">
  <div class="carousel-container">
    <!-- Close button -->
    <button class="close-button" (click)="closeCarousel()">
      <span class="material-symbols-outlined">close</span>
    </button>

    <!-- Navigation arrows -->
    <button class="nav-arrow prev" (click)="previous()" [class.disabled]="currentIndex === 0">
      <span class="material-symbols-outlined">chevron_left</span>
    </button>
    <button class="nav-arrow next" (click)="next()" [class.disabled]="currentIndex === publicaciones.length - 1">
      <span class="material-symbols-outlined">chevron_right</span>
    </button>

    <div class="carousel-content">
      <!-- Left side - Content -->
      <div class="content-section">
        <div class="content-container">
          <div *ngFor="let contenido of currentPublicacion.contenido" class="contenido-item">
            <!-- Image content -->
            <div *ngIf="contenido.tipo_contenido === 'imagen'" class="contenido-imagen">
              <img [src]="contenido.url_contenido" 
                   [alt]="contenido.nombre_archivo || 'Imagen'" 
                   class="imagen-preview">
            </div>
            
            <!-- Video content -->
            <div *ngIf="contenido.tipo_contenido === 'video'" class="contenido-video">
              <video controls 
                     class="video-preview" 
                     preload="auto"
                     controlsList="nodownload" 
                     disablePictureInPicture
                     playsinline
                     crossorigin="anonymous">
                <source [src]="contenido.url_contenido" type="video/mp4">
                Tu navegador no soporta la reproducci√≥n de video.
              </video>
            </div>
            
            <!-- Link content -->
            <div *ngIf="contenido.tipo_contenido === 'enlace'" class="contenido-enlace">
              <ng-container *ngIf="isYouTubeLink(contenido.url_contenido ?? ''); else normalLink">
                <div class="youtube-embed-container">
                  <iframe
                    [src]="getSafeYouTubeEmbedUrl(contenido.url_contenido ?? '')"
                    frameborder="0"
                    allowfullscreen
                    loading="lazy"
                    style="width: 100%; aspect-ratio: 16/9; min-height: none; border-radius: 8px; background: #000;">
                  </iframe>
                </div>
              </ng-container>
              <ng-template #normalLink>
                <span class="material-symbols-outlined">link</span>
                <a [href]="contenido.url_contenido" target="_blank" rel="noopener noreferrer">
                  {{ contenido.url_contenido }}
                </a>
              </ng-template>
            </div>
            
            <!-- File content -->
            <div *ngIf="contenido.tipo_contenido === 'archivo'" class="contenido-archivo">
              <ng-container *ngIf="isPDF(contenido.url_contenido ?? ''); else normalFile">
                <div class="pdf-preview-container">
                  <iframe
                    [src]="getSafeUrl(contenido.url_contenido ?? '')"
                    class="pdf-preview"
                    type="application/pdf"
                    loading="lazy">
                  </iframe>
                </div>
              </ng-container>
              <ng-template #normalFile>
                <span class="material-symbols-outlined">description</span>
                <div class="archivo-info">
                  <a [href]="contenido.url_contenido" target="_blank" rel="noopener noreferrer" class="archivo-link">
                    <p class="archivo-nombre">{{ contenido.nombre_archivo }}</p>
                    <p class="archivo-tamano" *ngIf="contenido.tamano_archivo">
                      {{ formatFileSize(contenido.tamano_archivo) }}
                    </p>
                  </a>
                </div>
              </ng-template>
            </div>

            <!-- Text content -->
            <div *ngIf="contenido.tipo_contenido === 'texto'" class="contenido-texto">
              <p class="texto-contenido">{{ contenido.texto }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Right side - Info and comments -->
      <div class="info-section">
        <div class="publicacion-info">
          <h2 class="publicacion-titulo">{{ currentPublicacion.titulo }}</h2>
          
          <div class="publicacion-meta">
            <div class="author-info">
              <span class="author-avatar" *ngIf="currentPublicacion.avatar_url">
                <img [src]="currentPublicacion.avatar_url" alt="Avatar">
              </span>
              <span class="author-name">{{ currentPublicacion.nombre_usuario || 'Usuario' }}</span>
            </div>
            <span class="publicacion-fecha">{{ currentPublicacion.fecha_creacion | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>

          <div class="like-container">
            <label class="container">
              <input type="checkbox" 
                     [checked]="userLikes[currentPublicacion.id_publicacion]"
                     [disabled]="likesLoading[currentPublicacion.id_publicacion]"
                     (change)="onLikeToggle(currentPublicacion.id_publicacion)">
              <svg id="Layer_1" version="1.0" viewBox="0 0 24 24" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M16.4,4C14.6,4,13,4.9,12,6.3C11,4.9,9.4,4,7.6,4C4.5,4,2,6.5,2,9.6C2,14,12,22,12,22s10-8,10-12.4C22,6.5,19.5,4,16.4,4z"></path></svg>
            </label>
            <span class="likes-count" *ngIf="likesCount[currentPublicacion.id_publicacion] > 0">
              {{ likesCount[currentPublicacion.id_publicacion] }}
            </span>
          </div>

          <div class="publicacion-descripcion" *ngIf="currentPublicacion.descripcion">
            <p>{{ currentPublicacion.descripcion }}</p>
          </div>
        </div>

        <!-- Comments section -->
        <div class="comments-section">
          <h3>Comentarios</h3>
          
          <div class="comments-list">
            <div *ngFor="let comment of currentPublicacion.comentarios" class="comment-item">
              <div class="comment-header">
                <span class="comment-author">{{ comment.nombre_usuario }}</span>
                <span class="comment-date">{{ comment.fecha_creacion | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
              <p class="comment-text">{{ comment.contenido }}</p>
            </div>
          </div>

          <div class="add-comment">
            <textarea 
              [(ngModel)]="newComment" 
              placeholder="Escribe un comentario..."
              rows="3">
            </textarea>
            <button class="send-comment" (click)="addComment()" [disabled]="!newComment.trim()">
              <span class="material-symbols-outlined">send</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 